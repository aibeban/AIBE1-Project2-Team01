<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 프로필 보기</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
<div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow space-y-6">
    <div>
        <h2 class="text-3xl font-bold text-gray-800">👤 내 프로필</h2>
    </div>

    <div class="space-y-4">
        <div>
            <h3 class="text-sm text-gray-500">닉네임</h3>
            <p id="nickname" class="text-lg font-semibold text-gray-800"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">이메일</h3>
            <p id="email" class="text-gray-700"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">소개</h3>
            <p id="bio" class="text-gray-700"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">연락처</h3>
            <p id="phone" class="text-gray-700"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">기술 태그</h3>
            <div id="techTags" class="flex flex-wrap gap-2"></div>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">성향 설명</h3>
            <div id="personalityText" class="inline-block bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full font-medium"></div>
        </div>
    </div>

    <div class="text-right">
        <button onclick="location.href='/profile/edit'" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition">
            프로필 수정
        </button>
    </div>
</div>
<button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
    로그아웃
</button>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch('/api/profile/me/full');
            if (res.status === 401 || res.status === 403) {
                window.location.href = '/auth/signin';
                return;
            }
            if (!res.ok) throw new Error('데이터 불러오기 실패');

            const data = await res.json();

            document.getElementById('nickname').textContent = data.profile.nickname;
            document.getElementById('email').textContent = data.profile.email;
            document.getElementById('bio').textContent = data.profile.bio;
            document.getElementById('phone').textContent = data.profile.phone;

            // 기술 태그 출력
            const techTagsEl = document.getElementById('techTags');
            (data.tags.techTags || []).forEach(tag => {
                const span = document.createElement('span');
                span.textContent = tag;
                span.className = "inline-block bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full";
                techTagsEl.appendChild(span);
            });

            // 성향 설명 출력
            document.getElementById('personalityText').textContent = data.tags.personalityText || '정보 없음';
        } catch (err) {
            console.error('❌ 프로필 조회 중 오류 발생:', err);
            window.location.href = '/auth/signin';
        }
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
        try {
            const res = await fetch('/auth/logout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            if (res.ok) {
                alert('로그아웃 되었습니다.');
                window.location.href = '/auth/signin';
            } else {
                throw new Error('서버 응답 오류');
            }
        } catch (err) {
            console.error('❌ 로그아웃 실패:', err);
            alert('로그아웃 중 오류가 발생했습니다.');
        }
    });

</script>
</body>
</html>
