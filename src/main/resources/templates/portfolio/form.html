<div th:fragment="content" class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md">

    <!-- 제목 -->
    <h1 class="text-3xl font-bold text-gray-800 mb-8 border-b pb-4">
        포트폴리오 등록 <!--TODO: 등록/수정 제목 -->
    </h1>

    <form th:action="@{/portfolios/new}" method="post" enctype="multipart/form-data" th:object="${portfolio}"
          class="space-y-8">
        <!-- TODO:CSRF -->
<!--        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">-->


        <!-- 유효성 오류 표시 -->
        <div th:if="${#fields.hasErrors('*')}" class="p-4 bg-red-50 rounded-lg border border-red-200">
            <h3 class="text-red-600 font-medium mb-2">다음 오류를 확인해주세요:</h3>
            <ul class="list-disc list-inside text-red-500 space-y-1">
                <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
            </ul>
        </div>

        <!-- 타입 선택 섹션 -->
        <div class="space-y-4">
            <label class="block text-lg font-semibold text-gray-700">포트폴리오 타입</label>
            <div class="flex flex-wrap gap-4">
                <div th:each="type : ${allTypes}">
                    <input type="radio" th:id="${'type-' + type}"
                           th:value="${type}" name="portfolioType"
                           th:checked="${portfolio.portfolioType == type}"
                           class="peer hidden">
                    <label th:for="${'type-' + type}"
                           class="inline-block px-6 py-3 border-2 rounded-lg cursor-pointer
                                  peer-checked:border-primary peer-checked:bg-primary/10 peer-checked:text-primary
                                  hover:bg-gray-50 transition-colors">
                        <span th:text="${type}"></span>
                    </label>
                </div>
            </div>
            <span th:errors="${portfolio.portfolioType}" class="block text-sm text-red-500 mt-1"></span>
        </div>

        <!-- 제목 섹션 -->
        <div class="space-y-2">
            <label for="title" class="block text-lg font-semibold text-gray-700">제목</label>
            <input type="text" id="title" name="title" th:value="${portfolio.title}"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                   placeholder="포트폴리오 제목을 입력해주세요">
            <span th:errors="${portfolio.title}" class="block text-sm text-red-500"></span>
        </div>

        <!-- 설명 섹션 -->
        <div class="space-y-2">
            <label for="description" class="block text-lg font-semibold text-gray-700">설명</label>
            <textarea id="description" name="description" rows="6"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                      placeholder="포트폴리오에 대한 상세 설명을 작성해주세요 (최대 2000자)"
                      th:text="${portfolio.description}"></textarea>
            <span th:errors="${portfolio.description}" class="block text-sm text-red-500"></span>
        </div>

        <!-- 파일 업로드 섹션 -->
        <div class="space-y-2">
            <label class="block text-lg font-semibold text-gray-700">파일 첨부</label>
            <div class="mt-1 flex justify-center px-6 pt-8 pb-8 border-2 border-dashed border-gray-300 rounded-xl hover:border-primary transition-colors bg-gray-50">
                <div class="space-y-3 text-center">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"
                         aria-hidden="true">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="flex justify-center text-sm text-gray-600">
                        <label for="file-upload"
                               class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-secondary focus-within:outline-none">
                            <span>파일 선택</span>
                            <input id="file-upload" name="files" type="file" multiple class="sr-only">
                        </label>
                        <p class="pl-1">또는 드래그 앤 드롭</p>
                    </div>
                    <p class="text-xs text-gray-500">PDF, DOC, XLS, PNG, JPG 파일 (최대 10MB)</p>
                </div>
            </div>
        </div>

        <!-- URL 추가 섹션 -->
        <div class="space-y-2">
            <label class="block text-lg font-semibold text-gray-700">참고 URL</label>
            <div class="flex gap-2">
                <input type="text" id="url-input" placeholder="https://github.com"
                       class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                <button type="button" id="add-url"
                        class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                    추가
                </button>
            </div>
            <div id="url-container" class="mt-2 space-y-2">
                <!-- 기존 URL 목록 -->
                <div th:each="url : ${portfolio.urls}"
                     class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                    <a th:href="${url}" th:text="${url}" target="_blank"
                       class="text-blue-500 hover:underline truncate"></a>
                    <button type="button" class="text-red-400 hover:text-red-600" onclick="this.parentElement.remove()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                  d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                  clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <input type="hidden" name="urls" th:value="${url}">
                </div>
            </div>
        </div>

        <!-- 버튼 그룹 -->
        <div class="flex justify-end gap-4 pt-6 border-t">
            <a th:href="@{/portfolios}"
               class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                취소
            </a>
            <button type="submit"
                    class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                저장하기
            </button>
        </div>
    </form>

    <script>
        // URL 추가 기능
        document.getElementById('add-url').addEventListener('click', function () {
            const urlInput = document.getElementById('url-input');
            const url = urlInput.value.trim();

            if (!url) return;

            const container = document.getElementById('url-container');
            const urlId = 'url-' + Date.now();

            const div = document.createElement('div');
            div.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-lg';
            div.innerHTML = `
                <a href="${url}" target="_blank" class="text-blue-500 hover:underline truncate">${url}</a>
                <button type="button" class="text-red-400 hover:text-red-600" onclick="this.parentElement.remove()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <input type="hidden" name="urls" value="${url}">
            `;

            container.appendChild(div);
            urlInput.value = '';
        });
    </script>
</div>